## トランザクションバッチの作成

デポジット(Ethereum> Cosmos転送)は単一の操作として発生します。各デポジットは、[デポジットspce](deposit-spec.md)を参照して投票される単一のオラクルイベントを作成します。イーサリアムガスは非常に高価であるため、引き出しはより複雑です。バリデーターの署名を検証するコストをできるだけ多くのトランザクションに分散させたいと考えています。したがって、バッチ。

ユーザーがMsgSendToEthを呼び出すと、いくつかのトークンといくつかの料金値が、バッチの入力を待機しているトランザクションのプールである「Gravitityxpool」にロックされます。

トランザクションバッチには、すべてのトランザクションと料金に対して単一の統一されたERC20トークントークンタイプのみが含まれます。

中継者はプールを監視し、特定のERC20契約のバッチに対して支払われる可能性のある料金を照会します。中継者(または誰でも)は、特定のトークンタイプのバッチの作成を要求できます。それが完了すると、バリデーターはオーケストレーターを介してこのバッチを承認します。

プールにそのトークンタイプのトランザクションがない場合、または新しいバッチの合計料金が、実行を待機している既存のバッチよりも高くない場合、バッチの作成が失敗する可能性があります。

この時点で、任意の中継者(バッチまたはその他を要求した中継者)がそれらの署名をバンドルし、結果をイーサリアムに送信できます。そのバッチ内のすべてのトランザクションのすべての料金と引き換えにガス料金を支払う。

リレーがバッチを要求する間、それらはGravity Cosmosモジュール自体によって作成され、その特定のトークンタイプのプールで最も高い料金のトランザクションが最初に実行されます。バッチごとに現在最大100トランザクション。

トランザクションがプール内にある間、ユーザーはMsgCancelSendToEthを送信することで払い戻しをリクエストし、トークンを取り戻すことができますが、トランザクションがバッチに入ると、これは不可能になります。署名が入り始めるとすぐにそのバッチがイーサリアムで実行される可能性があるため。

MsgSendToEthトランザクションがプールから出て、バッチで3つのことの1つがファンドに発生する必要があります。

1.バッチはイーサリアムで実行され、転送が完了し、ロックされたトークンがコスモスで書き込まれます
2.バッチがタイムアウトし、ブロック単位のタイムアウトの高さに達すると、ロックされたトークンがプールに返されます
3.後のバッチが実行され、これが無効になり、送信できなくなります。ロックされたトークンはプールに戻されます

## より収益性の高いバッチの作成

バッチの一般的なフローが解決されたら、バッチ作成の最大の問題に焦点を当てる必要があります。許可のない要求が常に中継される可能性のあるバッチになることを保証します。大量の低料金のスパムと敵対的なバッチリクエスターが与えられたとしても。

低料金のスパムトランザクションが無限に流れているとします。
重力txプールに。その後、任意のバッチ作成イベントがロックされます
数十のスパムトランザクションで高額の「良いトランザクション」を増やします。

この場合、すべてのリレーがバッチをリレーすることを選択することはありません。
それらは不採算になります。

収益性の高いバッチが最終的に作成されることを保証するために、
高額の「良い取引」を明らかに閉じ込めないようにする必要があります
悪いバッチ。難しさを増すために、私たちは実際に何を知らない
このプロセスのトークンは価値があるか、ETHガスのコストです。

このパッチが提供する解決策は、常に新しいバッチを確保することです
最後のバッチよりも高い料金がかかります。これは、たとえあるとしても
無限のスパムトランザクション、および許可の無限のスパムが少ない
バッチリクエストの作成バッチの作成は、十分な時間停止します
プールで構築するための良好なトランザクションと新しいより収益性の高い
作成するバッチ。

十分に長いタイムスケールで、古いバッチはいずれかのタイムアウトになります。戻る
新しいさらに良いバッチを作成するためのプールへの収益性の高いトランザクション。または
最新のバッチの収益性は、1つになるまで増加し続けます
中継され、前の良好なトランザクションを解放して次のトランザクションに移します
バッチ。

したがって、この条件が与えられると、入力に関係なく、
成功したバッチは最終的に作成されます。

## 中継設定に関する注意

中継者はイーサリアムの価格を自由に観察し、特定のトークンの為替レートを知ることができることを忘れないでください。また、支払われるトークンの設定が異なる場合もあります。たとえば、DAIがすでにDAIをETHに清算して、より多くのバッチを支払う場合は、DAIごとの方が安くなります。ユニスワップでETHと交換するのに50ドルかかる場合、200ドルのDAI報酬は150ドルの価値しかありません。しかし、すでにDAIに1,000ドルある場合、50ドルはそれほど悪くはないようです。

これが、バッチリクエストが許可なしでオープンでなければならない理由です。非常に複雑なトークン価格オラクルがなければ、コスモスチェーン自体が特定のトークンの価格を知ることができないだけでなく、中継者の好みは完全に主観的です。