## 交易批量创建

存款(以太坊> Cosmos 转账)作为单一操作发生。每个存款创建一个单一的预言机事件，该事件被投票见 [存款 spce](deposit-spec.md)。提款更加复杂，因为以太坊的 gas 非常昂贵，我们希望在尽可能多的交易中分摊验证验证者签名的成本。因此分批。

当用户调用 MsgSendToEth 时，他们会将一些代币和一些费用值锁定到“重力交易池”中，这是一个等待进入批次的交易池。

交易批次仅包含所有交易和费用的单一统一 ERC20 代币类型。

中继者观察池并查询他们可能为一批给定的 ERC20 合约支付的费用。中继器(或任何人)可以请求为特定的令牌类型创建一个批次。完成后，验证器将通过其编排器签署该批次。

如果池中没有该代币类型的交易，或者新批次的总费用不会高于等待执行的现有批次，则批次创建可能会失败。

此时，任何中继器(请求批处理的中继器或其他中继器)都可以捆绑这些签名并将结果提交给以太坊。支付gas费用以换取该批次中所有交易的所有费用。

当中继器请求批处理时，它们是由 Gravity Cosmos 模块本身创建的，池中该特定令牌类型的最高费用交易首先进行。目前每批最多 100 笔交易。

当交易在池中时，用户可以通过发送 MsgCancelSendToEth 来请求退款并取回他们的代币，但是一旦交易成批处理，这将不再可能。因为一旦签名开始进入，该批次就有可能在以太坊上执行。

一旦 MsgSendToEth 交易从池中出来，并且在批处理中，资金必须发生以下三件事之一。

1.批量在以太坊上执行，转账完成，锁定代币在Cosmos上烧毁
2. 批量超时，一旦达到块的超时高度，锁定的代币将返回到池中
3. 执行后一批，使这批无效，无法提交。锁定的代币然后返回到池中

## 创造更有利可图的批次

随着批处理的一般流程解决，我们应该关注批处理创建的最大问题。确保未经许可的请求总是导致可以中继的批次。即使有大量的低费用垃圾邮件和恶意批处理请求者。

假设我们有无限流的低费用垃圾邮件交易
进入重力交易池。然后将锁定任何给定的批处理创建事件
通过数十次垃圾邮件交易提高高费用“良好交易”。

在这种情况下，没有中继者会选择中继一批，因为所有的
他们将无利可图。

为了确保最终创建有利可图的批次，我们
必须避免将高费用的“好交易”锁定在明显的
坏批次。为了增加难度，我们实际上不知道有什么
在这个过程中的代币价值或 ETH gas 成本。

此补丁提供的解决方案是确保新批次始终
费用比上一批高。这意味着即使有
无限垃圾邮件交易，以及无限垃圾邮件的权限更少
创建批处理请求批处理创建将停止足够长的时间
在池中建立良好的交易和新的更有利可图的交易
要创建的批处理。

在足够长的时间范围内，旧批次要么超时。返回
有利可图的交易到池中，以创建一个新的更好的批次。或者
最新一批的盈利能力继续增加，直到一个
转发，也释放了之前的良好交易进入下一个
批。

因此，鉴于这种情况，我们可以说无论输入如何
最终将创建成功的批处理。

## 关于中继偏好的注意事项

请记住，中继者可以自由观察以太坊上的价格，并知道给定代币的汇率是多少。他们也可能对支付的代币有不同的偏好，例如，如果您已经让 DAI 将该 DAI 清算为 ETH 以支付更多批次的费用，则每个 DAI 会更便宜。如果在 uniswap 上花费 50 美元将其兑换为 ETH，则 200 美元的 DAI 奖励仅价值 150 美元。但是，如果您已经拥有 1000 美元的 DAI，那么 50 美元似乎还不错。

这就是为什么批处理请求必须是无需许可和开放的。在没有非常复杂的代币价格预言机的情况下，Cosmos 链本身不仅无法知道任何给定代币的价格，而且中继者的偏好是完全主观的。